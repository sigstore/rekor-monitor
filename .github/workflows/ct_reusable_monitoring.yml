# Copyright 2024 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

name: Certificate Transparency Monitoring Template

on:
  workflow_call:
    inputs:
      file_issue:
        description: 'True to file an issue on monitoring failure'
        required: true
        type: boolean
      artifact_retention_days:
        description: 'The number of days to retain an artifact (default: 14). If this workflow runs as a cron job, it must be greater than the frequency of the job'
        required: false
        type: number
        default: 14
      once:
        description: 'whether to run the identity monitor once or periodically'
        default: true
        required: false
        type: boolean
      config:
        description: 'multiline yaml of configuration settings for identity monitor run'
        required: false
        type: string
      url:
        description: 'Optional URL to pass to the monitor'
        required: false
        type: string

permissions:
  contents: read
  id-token: write
  issues: write

jobs:
  ct-monitoring:
    uses: ./.github/workflows/base_monitoring.yml
    with:
      uploaded_log_name: ct_checkpoint
      checkpoint_file: ct_checkpoint_log.txt
      monitor_type: ct
      file_issue: ${{ inputs.file_issue }}
      artifact_retention_days: ${{ inputs.artifact_retention_days }}
      once: ${{ inputs.once }}
      config: ${{ inputs.config }}
      url: ${{ inputs.url }}
